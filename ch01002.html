<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>感測器測試頁面 (Tabs)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, sans-serif; margin: 16px; line-height: 1.6; }
    h1 { font-size: 1.3rem; margin-bottom: 8px; }
    .tabs { display: flex; border-bottom: 2px solid #ccc; margin-top: 16px; }
    .tab-btn {
      flex: 1; padding: 10px; cursor: pointer; text-align: center;
      border: none; background: #f5f5f5; font-size: 1rem;
    }
    .tab-btn.active { background: #fff; border-bottom: 2px solid #007bff; font-weight: bold; }
    .tab-content { display: none; padding: 12px; border: 1px solid #ccc; border-top: none; }
    .tab-content.active { display: block; }
    table { width: 100%; border-collapse: collapse; margin-top: 8px; }
    th, td { border: 1px solid #eee; padding: 6px 8px; text-align: left; font-variant-numeric: tabular-nums; }
    th { background: #f7f7f7; }
    .badge { padding: 2px 6px; border-radius: 999px; font-size: 0.85em; }
    .ok { background: #e6f5ea; color: #0a7b30; }
    .no { background: #fde8e8; color: #b42318; }
    .warn { background: #fff6e6; color: #8a5800; }
    .touchbox { border: 1px dashed #ccc; border-radius: 6px; min-height: 100px; display: flex; align-items: center; justify-content: center; margin-top: 10px; }
    .btn { padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px; background: #fafafa; cursor: pointer; margin: 2px; }
    .mono { font-family: monospace; }
  </style>
</head>
<body>
  <h1>行動裝置感測器測試頁面</h1>
  <div class="tabs">
    <button class="tab-btn active" data-tab="support">支援狀態</button>
    <button class="tab-btn" data-tab="motion">DeviceMotion</button>
    <button class="tab-btn" data-tab="orientation">DeviceOrientation</button>
    <button class="tab-btn" data-tab="touch">Touch</button>
  </div>

  <div id="support" class="tab-content active">
    <h2>支援狀態檢測</h2>
    <table>
      <tbody id="supportTable"></tbody>
    </table>
  </div>

  <div id="motion" class="tab-content">
    <h2>DeviceMotion (加速度/旋轉)</h2>
    <table>
      <tr><th>加速度</th><td class="mono" id="acc"></td></tr>
      <tr><th>含重力加速度</th><td class="mono" id="accG"></td></tr>
      <tr><th>旋轉速率</th><td class="mono" id="rot"></td></tr>
      <tr><th>取樣間隔</th><td class="mono" id="interval"></td></tr>
    </table>
  </div>

  <div id="orientation" class="tab-content">
    <h2>DeviceOrientation (方向角)</h2>
    <table>
      <tr><th>alpha</th><td class="mono" id="alpha"></td></tr>
      <tr><th>beta</th><td class="mono" id="beta"></td></tr>
      <tr><th>gamma</th><td class="mono" id="gamma"></td></tr>
      <tr><th>absolute</th><td class="mono" id="absolute"></td></tr>
    </table>
  </div>

  <div id="touch" class="tab-content">
    <h2>Touch 觸控測試</h2>
    <div id="touchbox" class="touchbox">在此框內觸控或滑動</div>
    <table>
      <tr><th>觸點數</th><td class="mono" id="touchCount"></td></tr>
      <tr><th>主要觸點</th><td class="mono" id="touchPos"></td></tr>
      <tr><th>事件</th><td class="mono" id="touchEvt"></td></tr>
    </table>
  </div>

  <script>
    // Tab 切換
    document.querySelectorAll(".tab-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
        document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
        btn.classList.add("active");
        document.getElementById(btn.dataset.tab).classList.add("active");
      });
    });

    // 支援度檢查
    const support = {
      DeviceMotionEvent: 'DeviceMotionEvent' in window,
      DeviceOrientationEvent: 'DeviceOrientationEvent' in window,
      TouchEvents: 'ontouchstart' in window || navigator.maxTouchPoints > 0,
      Vibration: 'vibrate' in navigator
    };
    const badge = (ok) => `<span class="badge ${ok?'ok':'no'}">${ok?'支援':'不支援'}</span>`;
    document.getElementById("supportTable").innerHTML = `
      <tr><th>DeviceMotionEvent</th><td>${badge(support.DeviceMotionEvent)}</td></tr>
      <tr><th>DeviceOrientationEvent</th><td>${badge(support.DeviceOrientationEvent)}</td></tr>
      <tr><th>Touch Events</th><td>${badge(support.TouchEvents)}</td></tr>
      <tr><th>Vibration API</th><td>${badge(support.Vibration)}</td></tr>
    `;

    // DeviceMotion
    window.addEventListener("devicemotion", e => {
      const a = e.acceleration || {};
      const ag = e.accelerationIncludingGravity || {};
      const r = e.rotationRate || {};
      document.getElementById("acc").textContent = `x=${a.x?.toFixed(2)} y=${a.y?.toFixed(2)} z=${a.z?.toFixed(2)}`;
      document.getElementById("accG").textContent = `x=${ag.x?.toFixed(2)} y=${ag.y?.toFixed(2)} z=${ag.z?.toFixed(2)}`;
      document.getElementById("rot").textContent = `alpha=${r.alpha?.toFixed(2)} beta=${r.beta?.toFixed(2)} gamma=${r.gamma?.toFixed(2)}`;
      document.getElementById("interval").textContent = e.interval;
    });

    // DeviceOrientation
    window.addEventListener("deviceorientation", e => {
      document.getElementById("alpha").textContent = e.alpha?.toFixed(2);
      document.getElementById("beta").textContent = e.beta?.toFixed(2);
      document.getElementById("gamma").textContent = e.gamma?.toFixed(2);
      document.getElementById("absolute").textContent = e.absolute;
    });

    // Touch
    const box = document.getElementById("touchbox");
    function showTouch(ev, type) {
      const t = ev.touches[0];
      document.getElementById("touchCount").textContent = ev.touches.length;
      document.getElementById("touchPos").textContent = t ? `x=${t.clientX} y=${t.clientY}` : "—";
      document.getElementById("touchEvt").textContent = type;
    }
    box.addEventListener("touchstart", e => showTouch(e, "touchstart"), {passive:false});
    box.addEventListener("touchmove", e => showTouch(e, "touchmove"), {passive:false});
    box.addEventListener("touchend", e => showTouch(e, "touchend"));
  </script>
</body>
</html>
