<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>è¡Œå‹•è£ç½®é€šè¨Š/æ„Ÿæ¸¬å™¨ æ¸¬è©¦é é¢ Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans TC", "PingFang TC", sans-serif; margin: 16px; line-height: 1.6; }
    h1 { font-size: 1.3rem; margin: 0 0 8px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 12px; }
    section { border: 1px solid #ddd; border-radius: 8px; padding: 12px; }
    table { width: 100%; border-collapse: collapse; margin-top: 6px; }
    th, td { border: 1px solid #eee; padding: 6px 8px; text-align: left; vertical-align: top; font-variant-numeric: tabular-nums; }
    th { background: #f7f7f7; }
    .badge { display: inline-block; padding: 2px 8px; border-radius: 999px; font-size: 12px; }
    .ok { background: #e6f5ea; color: #0a7b30; }
    .no { background: #fde8e8; color: #b42318; }
    .warn { background: #fff6e6; color: #8a5800; }
    .btn { cursor: pointer; padding: 8px 12px; border-radius: 6px; border: 1px solid #ccc; background: #fafafa; }
    .btn + .btn { margin-left: 6px; }
    .muted { color: #666; font-size: 0.92em; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    .live { font-weight: 600; }
    .flex { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    .small { font-size: 0.92em; }
    .touchbox { border: 1px dashed #ccc; border-radius: 6px; min-height: 120px; display: flex; align-items: center; justify-content: center; user-select: none; }
  </style>
</head>
<body>
  <h1>è¡Œå‹•è£ç½®é€šè¨Š/æ„Ÿæ¸¬å™¨ æ¸¬è©¦é é¢</h1>
  <p class="muted small">
    æœ¬é ç¤ºç¯„ï¼šDeviceMotionï¼ˆåŠ é€Ÿåº¦/æ—‹è½‰ï¼‰ã€DeviceOrientationï¼ˆæ–¹å‘è§’ï¼‰ã€Touch è§¸æ§ã€Vibration éœ‡å‹•ã€‚<br>
    iOS Safari éœ€ <strong>HTTPS</strong> ä¸”ä½¿ç”¨è€…äº’å‹•å¾Œï¼Œæ‰å¯æˆæ¬Šæ„Ÿæ¸¬å™¨äº‹ä»¶ã€‚
  </p>

  <section>
    <div class="flex">
      <button id="btnStart" class="btn">â–¶ï¸ é–‹å§‹ç›£è½</button>
      <button id="btnStop" class="btn" disabled>â¸ åœæ­¢ç›£è½</button>
      <button id="btnPerm" class="btn">ğŸ” iOS æ„Ÿæ¸¬å™¨æ¬Šé™</button>
      <button id="btnVibrate" class="btn">ğŸ“³ æ¸¬è©¦éœ‡å‹•</button>
      <span id="secureState" class="badge"></span>
    </div>
    <p id="note" class="muted small" style="margin-top:8px;"></p>
  </section>

  <div class="grid" style="margin-top:12px;">
    <section>
      <h2>æ”¯æ´ç‹€æ…‹</h2>
      <table>
        <tbody id="supportTable">
          <!-- Filled by JS -->
        </tbody>
      </table>
      <p class="muted small">æç¤ºï¼šè‹¥é¡¯ç¤ºä¸æ”¯æ´ï¼Œå¯èƒ½æ˜¯ç€è¦½å™¨æˆ–å¹³å°é™åˆ¶ï¼›iOS Safari ä¸æ”¯æ´ Vibrationã€‚</p>
    </section>

    <section>
      <h2>DeviceMotionï¼ˆåŠ é€Ÿåº¦/æ—‹è½‰é€Ÿç‡ï¼‰</h2>
      <table>
        <tbody>
          <tr><th>åŠ é€Ÿåº¦ (m/sÂ²)</th><td class="mono"><span class="live" id="acc"></span></td></tr>
          <tr><th>å«é‡åŠ›åŠ é€Ÿåº¦ (m/sÂ²)</th><td class="mono"><span class="live" id="accG"></span></td></tr>
          <tr><th>æ—‹è½‰é€Ÿç‡ (Â°/s)</th><td class="mono"><span class="live" id="rot"></span></td></tr>
          <tr><th>å–æ¨£é–“éš” (ms)</th><td class="mono"><span class="live" id="interval"></span></td></tr>
        </tbody>
      </table>
      <p class="muted small">èªªæ˜ï¼šç”±ç€è¦½å™¨äº‹ä»¶ä¼°ç®—ï¼›ä¸åŒè£ç½®ç²¾åº¦å·®ç•°å¤§ã€‚</p>
    </section>

    <section>
      <h2>DeviceOrientationï¼ˆæ–¹å‘è§’ï¼‰</h2>
      <table>
        <tbody>
          <tr><th>alpha (Â°)</th><td class="mono"><span class="live" id="alpha"></span></td></tr>
          <tr><th>beta (Â°)</th><td class="mono"><span class="live" id="beta"></span></td></tr>
          <tr><th>gamma (Â°)</th><td class="mono"><span class="live" id="gamma"></span></td></tr>
          <tr><th>absolute</th><td class="mono"><span class="live" id="absolute"></span></td></tr>
        </tbody>
      </table>
      <p class="muted small">èªªæ˜ï¼šè£ç½®ç›¸å°åœ°çƒåº§æ¨™çš„è§’åº¦ï¼›ä¸åŒç€è¦½å™¨æ ¡æ­£æ–¹å¼ç•¥æœ‰å·®ç•°ã€‚</p>
    </section>

    <section>
      <h2>Touch è§¸æ§</h2>
      <div id="touchbox" class="touchbox">åœ¨æ­¤æ¡†å…§ <strong>æŒ‰ä½/æ»‘å‹•/å¤šæŒ‡è§¸æ§</strong></div>
      <table style="margin-top:8px;">
        <tbody>
          <tr><th>è§¸é»æ•¸</th><td class="mono"><span class="live" id="touchCount"></span></td></tr>
          <tr><th>ä¸»è¦è§¸é»åº§æ¨™</th><td class="mono"><span class="live" id="touchPos"></span></td></tr>
          <tr><th>äº‹ä»¶</th><td class="mono"><span class="live" id="touchEvt"></span></td></tr>
        </tbody>
      </table>
      <p class="muted small">èªªæ˜ï¼šæ”¯æ´å¤šé»è§¸æ§ï¼›æ¡Œé¢ç€è¦½å™¨å¯èƒ½æ”¹ä»¥æ»‘é¼ äº‹ä»¶è§¸ç™¼ã€‚</p>
    </section>
  </div>

  <script>
    // --------- å·¥å…·å‡½å¼ ---------
    const $ = (id) => document.getElementById(id);
    const fmt = (n, d=2) => (Number.isFinite(n) ? n.toFixed(d) : "â€”");
    const badge = (ok, textOk="æ”¯æ´", textNo="ä¸æ”¯æ´") =>
      `<span class="badge ${ok ? 'ok':'no'}">${ok?textOk:textNo}</span>`;

    // å®‰å…¨æƒ…å¢ƒï¼ˆHTTPS/localhostï¼‰æç¤º
    const isSecure = window.isSecureContext;
    $("secureState").className = `badge ${isSecure ? 'ok':'warn'}`;
    $("secureState").textContent = isSecure ? "ğŸ”’ Secure context" : "âš ï¸ éå®‰å…¨æƒ…å¢ƒï¼ˆiOS å¯èƒ½æ‹’çµ•æ¬Šé™ï¼‰";

    // --------- æ”¯æ´åº¦åµæ¸¬ ---------
    const support = {
      DeviceMotionEvent: 'DeviceMotionEvent' in window,
      DeviceOrientationEvent: 'DeviceOrientationEvent' in window,
      TouchEvents: 'ontouchstart' in window || navigator.maxTouchPoints > 0,
      Vibration: 'vibrate' in navigator
    };

    const supportRows = [
      ["DeviceMotionEventï¼ˆåŠ é€Ÿåº¦/æ—‹è½‰ï¼‰", support.DeviceMotionEvent],
      ["DeviceOrientationEventï¼ˆæ–¹å‘è§’ï¼‰", support.DeviceOrientationEvent],
      ["Touch Eventsï¼ˆè§¸æ§ï¼‰", support.TouchEvents],
      ["Vibration APIï¼ˆéœ‡å‹•ï¼‰", support.Vibration]
    ].map(([label, ok]) => `<tr><th>${label}</th><td>${badge(ok)}</td></tr>`).join("");
    $("supportTable").innerHTML = supportRows;

    // --------- iOS æ¬Šé™è«‹æ±‚ï¼ˆéœ€ä½¿ç”¨è€…é»æ“Šï¼‰ ---------
    async function requestIOSPermission() {
      const reqs = [];
      const DME = window.DeviceMotionEvent;
      const DOE = window.DeviceOrientationEvent;

      if (DME && typeof DME.requestPermission === "function") {
        reqs.push(DME.requestPermission().catch(e => e));
      }
      if (DOE && typeof DOE.requestPermission === "function") {
        reqs.push(DOE.requestPermission().catch(e => e));
      }
      if (reqs.length === 0) {
        $("note").textContent = "æ­¤ç€è¦½å™¨ä¸éœ€è¦ï¼ˆæˆ–ä¸æ”¯æ´ï¼‰é¡¯å¼æ„Ÿæ¸¬å™¨æ¬Šé™è«‹æ±‚ã€‚";
        return;
      }
      try {
        const results = await Promise.all(reqs);
        const txt = results.map((r, i) => `æˆæ¬Š${i+1}ï¼š${r && r.toString ? r.toString() : r}`).join(" / ");
        $("note").textContent = "æ¬Šé™çµæœ â†’ " + txt;
      } catch (err) {
        $("note").textContent = "æ¬Šé™è«‹æ±‚å¤±æ•—ï¼š" + err;
      }
    }

    // --------- äº‹ä»¶è™•ç†ï¼ˆå¯å•Ÿå‹•/åœæ­¢ï¼‰ ---------
    let running = false;
    let lastPaint = 0;

    const onMotion = (e) => {
      // ç°¡å–®ç¯€æµï¼š~8â€“10Hz æ›´æ–°ï¼Œé¿å… UI éè¼‰
      const now = performance.now();
      if (now - lastPaint < 100) return;
      lastPaint = now;

      const a = e.acceleration || {};
      const ag = e.accelerationIncludingGravity || {};
      const r = e.rotationRate || {};
      $("acc").textContent  = `x=${fmt(a.x)} y=${fmt(a.y)} z=${fmt(a.z)}`;
      $("accG").textContent = `x=${fmt(ag.x)} y=${fmt(ag.y)} z=${fmt(ag.z)}`;
      $("rot").textContent  = `alpha=${fmt(r.alpha)} beta=${fmt(r.beta)} gamma=${fmt(r.gamma)}`;
      $("interval").textContent = fmt(e.interval, 0);
    };

    const onOrient = (e) => {
      $("alpha").textContent = fmt(e.alpha);
      $("beta").textContent  = fmt(e.beta);
      $("gamma").textContent = fmt(e.gamma);
      $("absolute").textContent = String(!!e.absolute);
    };

    const touchBox = $("touchbox");
    const updTouch = (type, ev) => {
      const t = ev.touches && ev.touches[0];
      $("touchCount").textContent = ev.touches ? ev.touches.length : 0;
      $("touchPos").textContent = t ? `x=${fmt(t.clientX,0)} y=${fmt(t.clientY,0)}` : "â€”";
      $("touchEvt").textContent = type;
    };

    const onTouchStart = (e) => { updTouch("touchstart", e); };
    const onTouchMove  = (e) => { updTouch("touchmove", e); e.preventDefault(); };
    const onTouchEnd   = (e) => { updTouch("touchend", e); };

    function start() {
      if (running) return;
      running = true;
      $("btnStart").disabled = true;
      $("btnStop").disabled = false;

      // æ„Ÿæ¸¬å™¨äº‹ä»¶
      if (support.DeviceMotionEvent) {
        window.addEventListener("devicemotion", onMotion, { passive: true });
      }
      if (support.DeviceOrientationEvent) {
        window.addEventListener("deviceorientation", onOrient, { passive: true });
      }

      // è§¸æ§äº‹ä»¶
      touchBox.addEventListener("touchstart", onTouchStart, { passive: false });
      touchBox.addEventListener("touchmove",  onTouchMove,  { passive: false });
      touchBox.addEventListener("touchend",   onTouchEnd,   { passive: true });
      touchBox.addEventListener("touchcancel",onTouchEnd,   { passive: true });
    }

    function stop() {
      if (!running) return;
      running = false;
      $("btnStart").disabled = false;
      $("btnStop").disabled = true;

      window.removeEventListener("devicemotion", onMotion);
      window.removeEventListener("deviceorientation", onOrient);
      touchBox.removeEventListener("touchstart", onTouchStart);
      touchBox.removeEventListener("touchmove", onTouchMove);
      touchBox.removeEventListener("touchend", onTouchEnd);
      touchBox.removeEventListener("touchcancel", onTouchEnd);
    }

    // --------- éœ‡å‹•æ¸¬è©¦ ---------
    function vibrateTest() {
      if (!support.Vibration) {
        alert("æ­¤ç€è¦½å™¨/è£ç½®ä¸æ”¯æ´ Vibration API");
        return;
      }
      // ç¯„ä¾‹ï¼š200ms éœ‡å‹• â†’ 100ms åœ â†’ 200ms éœ‡å‹•
      navigator.vibrate([200, 100, 200]);
    }

    // --------- ç¶å®šæŒ‰éˆ• ---------
    $("btnStart").addEventListener("click", start);
    $("btnStop").addEventListener("click", stop);
    $("btnPerm").addEventListener("click", requestIOSPermission);
    $("btnVibrate").addEventListener("click", vibrateTest);

    // é è¨­ä¸è‡ªå‹•å•Ÿå‹•ï¼ˆéœ€äº’å‹•è¼ƒç¬¦åˆ iOS æ”¿ç­–ï¼‰ï¼›å¯æ”¹æˆè‡ªå‹• start()
  </script>
</body>
</html>
